#!/usr/bin/env bash
set -efuo pipefail

channel=$(cut --delimiter - --fields 1 <<< "$ASDF_INSTALL_VERSION")
date=$(cut --delimiter - --fields 2-4 <<< "$ASDF_INSTALL_VERSION")
host=$(cut --delimiter - --fields 5- <<< "$ASDF_INSTALL_VERSION")

tmp=$ASDF_INSTALL_PATH/tmp
mkdir "$tmp"

curl "https://static.rust-lang.org/dist/$date/rust-$channel-$host.tar.xz" \
| tar xJ -C "$tmp" --strip-components 1

"$tmp/install.sh" --prefix="$ASDF_INSTALL_PATH"
rm --recursive "$tmp"
